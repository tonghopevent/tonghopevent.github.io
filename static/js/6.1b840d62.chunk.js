(this["webpackJsonptonghopevent-frontend"]=this["webpackJsonptonghopevent-frontend"]||[]).push([[6],{152:function(t,e,n){"use strict";var s=n(299),a=n(181),i=n.n(a),o=n(182),c=n.n(o);e.a=Object(s.a)({palette:{primary:{main:i.a[700]},secondary:{main:i.a[200]},error:{main:c.a[900]}}})},163:function(t,e,n){},164:function(t,e,n){},238:function(t,e,n){},251:function(t,e,n){},282:function(t,e,n){},386:function(t,e,n){"use strict";n.r(e);var s=n(12),a=n.n(s),i=n(152),o=n(348),c=n(351),r=n(350),l=n(387),d=n(354),h=n(341),j=n(25),b=n.n(j),p=n(13),g=n(23),u=n(4);class x extends a.a.Component{constructor(t){super(),this.handleChange=t=>e=>{this.setState({[t]:e.target.value})},this.props=t,this.state={},window.changeHeader("Login")}async onLogin(){if(""===this.state.username||""===this.state.password)return window.showAlert({title:"Please fill in",text:"Please fill in your username and password"});{this.setState({loading:!0});const{username:t,password:e}=this.state,n=await b.a.post("".concat(p.a.BACKEND,"/login"),{username:t,password:e});if(this.setState({loading:!1}),!n.data.token)return window.showAlert({title:"Error",text:n.data.error});g.a.setLocalStorage("token",n.data.token),window.location.href="#/"}}async onRegister(){}render(){var t={input:{marginBottom:"20px",width:"500px",maxWidth:"100%"},container:{display:"flex",flexWrap:"wrap"},cardStyle:{maxWidth:"500px",marginTop:"20px",marginRight:"auto",marginLeft:"auto"}};const e=Object(u.jsxs)("div",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})})]}),n=Object(u.jsx)("div",{children:Object(u.jsx)(o.a,{style:t.cardStyle,children:Object(u.jsxs)(r.a,{children:[Object(u.jsx)(c.a,{variant:"h5",component:"h2",children:"Admin - TongHopEvent"}),Object(u.jsx)(c.a,{color:"textSecondary",children:"Please login to continue"}),Object(u.jsx)(l.a,{label:"Username",type:"text",value:this.state.username,style:t.input,onChange:this.handleChange("username"),margin:"normal"}),Object(u.jsx)(l.a,{label:"Password",type:"password",value:this.state.password,style:t.input,onChange:this.handleChange("password"),margin:"normal"}),Object(u.jsx)("div",{children:Object(u.jsx)(d.a,{onClick:this.onLogin.bind(this),color:"primary",children:"Login"})})]})})});return this.state.loading?e:n}}var m=x,O=n(225),f=n.n(O),v=n(362),k=n(363),y=n(246),w=n.n(y),C=n(239),D=n.n(C),S=n(358),_=n(355),T=n(361),I=n(359),N=n(360);class E extends a.a.Component{constructor(t){super(t),this.state={comment:t.doc.comment||""}}render(){const{comment:t}=this.state,{onClose:e}=this.props;return Object(u.jsx)(a.a.Fragment,{children:Object(u.jsxs)(_.a,{fullWidth:!0,open:!0,onClose:()=>e(!1),"aria-labelledby":"form-dialog-title",children:[Object(u.jsx)(S.a,{id:"form-dialog-title",children:"Ghi ch\xfa"}),Object(u.jsxs)(I.a,{children:[Object(u.jsx)(N.a,{children:"B\u1ea1n c\xf3 th\u1ec3 \u0111\u1ec3 l\u1ea1i ghi ch\xfa cho b\xe0i vi\u1ebft n\xe0y. Ch\u1ec9 c\xf3 Admin m\u1edbi nh\xecn th\u1ea5y ghi ch\xfa."}),Object(u.jsx)(l.a,{multiline:!0,rowsMax:"20",value:t,onChange:t=>{this.setState({comment:t.target.value})},margin:"normal",variant:"outlined",fullWidth:!0})]}),Object(u.jsxs)(T.a,{children:[Object(u.jsx)(d.a,{onClick:()=>e(!1),color:"primary",children:"Quay l\u1ea1i"}),Object(u.jsx)(d.a,{onClick:()=>e(t),color:"primary",children:"L\u01afU GHI CH\xda"})]})]})})}}var B=E;n(238);class A extends a.a.Component{constructor(t){super(),this.getImageUrl=()=>{const{doc:{image:t}}=this.props;return t&&0!==t.length?t[0].startsWith("http")?t[0]:"https://drive.google.com/uc?export=view&id=".concat(t[0]):null},this.props=t,this.state={loading:!1,isNoteEditOpen:!1,isCopied:!1,isExpanded:!this.props.admin,copyContent:this.props.admin?this.getCopyContent():""},this.props.doc&&this.props.doc.linkfb&&(this.fbusername=g.a.extractFacebookUsername(this.props.doc.linkfb)),t.admin&&(t.doc.image?this.state.publishAction="publish":this.fbusername?this.state.publishAction="getimage":this.state.publishAction=null)}async updateDocField(t,e,n,s){this.setState({loading:!0});const{doc:a}=this.props,i=await b.a.post(n,s);if(i.data.success){const n=JSON.parse(JSON.stringify(a));n[t]=e,this.props.setDoc(this.props.i,n)}else window.showAlert({title:"Error",text:i.data.error});this.setState({loading:!1})}async toggleTrashDoc(){const{doc:t}=this.props,e=!t.trashed,n=g.a.getLocalStorage("token");await this.updateDocField("trashed",e,"".concat(p.a.BACKEND,"/doc/").concat(t.id,"/trashed?token=").concat(n),{trashed:e})}async toggleApproved(){const{doc:t}=this.props,e=!t.approved,n=g.a.getLocalStorage("token");await this.updateDocField("approved",e,"".concat(p.a.BACKEND,"/doc/").concat(t.id,"/approved?token=").concat(n),{approved:e})}async updateComment(t){const{doc:e}=this.props,n=g.a.getLocalStorage("token");await this.updateDocField("comment",t||"","".concat(p.a.BACKEND,"/doc/").concat(e.id,"/comment?token=").concat(n),{comment:t})}getCopyContent(){const{doc:t}=this.props;return("-- ".concat(t.name," --\n")+"".concat(this.generateLocationTag(t)," ").concat(t.type.join(" "),"\n\n")+"\u25cf M\xf4 t\u1ea3: ".concat(t.description.trim(),"\n\n")+"\u25cf Link facebook: ".concat(g.a.cleanFBLink(t.linkfb),"\n")+(t.wanted&&t.wanted.length>0?"\u25cf Y\xeau c\u1ea7u \u0111\u1ed1i t\u01b0\u1ee3ng: "+t.wanted.join(", ").trim()+"\n":"")+(t.deadline?"\u25cf Deadline tuy\u1ec3n nh\xe2n s\u1ef1: "+t.deadline.trim()+"\n":"")+(t.benefit?"\u25cf Quy\u1ec1n l\u1ee3i khi tham gia d\u1ef1 \xe1n:\n"+t.benefit.trim()+"\n":"")+"\nTrackID:".concat(t.psid,":").concat(t.id)).trim()}generateLocationTag(t){const{location:e,locations:n}=t,s=[];console.log(t);const a=t=>{s.push("To\xe0n qu\u1ed1c"===t?"#d\u1ef1_\xe1n_to\xe0n_qu\u1ed1c":"#d\u1ef1_\xe1n_\u1edf_".concat(t.replace(/\s+/g,"_")))};return e&&a(e),n&&n.forEach(a),s.join(" ")}_renderNonAdminInfo(){const{doc:t}=this.props;return Object(u.jsx)("p",{style:{backgroundColor:t.trashed?"#ffa3a3":"#eee",padding:"10px",width:"100%"},children:Object(u.jsx)("center",{children:t.trashed?"B\xe0i vi\u1ebft n\xe0y \u0111\xe3 b\u1ecb t\u1eeb ch\u1ed1i":t.approved?"B\xe0i vi\u1ebft n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c duy\u1ec7t v\xe0 s\u1ebd s\u1edbm \u0111c \u0111\u0103ng l\xean fanpage":"B\xe0i vi\u1ebft n\xe0y \u0111ang \u0111\u1ee3i \u0111\u1ec3 \u0111\u01b0\u1ee3c ki\u1ec3m duy\u1ec7t"})})}_renderDuplicatedWarningIcon(){const{doc:t,duplicateHelper:e,openDuplicateDocDialog:n}=this.props;if(!e||t.approved)return null;const s=e.checkDoc(t);return s?Object(u.jsx)(v.a,{size:"small",color:"primary",style:{marginRight:"15px"},onClick:()=>n(s,t.id),children:Object(u.jsx)(D.a,{})}):null}_renderPostContent(){const{doc:t}=this.props;return Object(u.jsxs)(a.a.Fragment,{children:[Object(u.jsxs)("p",{children:[this.generateLocationTag(t)," ",t.type.join(" ")]}),Object(u.jsx)("p",{children:g.a.nl2br(t.description)}),Object(u.jsxs)("p",{children:["\u25cf Link facebook: ",g.a.cleanFBLink(t.linkfb),Object(u.jsx)("br",{}),t.wanted&&t.wanted.length>0&&Object(u.jsxs)("span",{children:["\u25cf Y\xeau c\u1ea7u \u0111\u1ed1i t\u01b0\u1ee3ng: ",t.wanted.join(", "),Object(u.jsx)("br",{})]}),!!t.deadline&&Object(u.jsxs)("span",{children:["\u25cf Deadline tuy\u1ec3n nh\xe2n s\u1ef1: ",g.a.nl2br(t.deadline),Object(u.jsx)("br",{})]}),!!t.benefit&&Object(u.jsxs)("span",{children:["\u25cf Quy\u1ec1n l\u1ee3i khi tham gia d\u1ef1 \xe1n: ",Object(u.jsx)("br",{}),g.a.nl2br(t.benefit),Object(u.jsx)("br",{})]})]}),this.props.admin&&Object(u.jsxs)("p",{children:["TrackID:",t.psid,":",t.id]}),!!t.image&&Object(u.jsxs)("p",{children:["\u1ea2nh tu\u1ef3 ch\u1ecdn: ",Object(u.jsx)("a",{href:this.getImageUrl(),target:"_blank",rel:"noopener noreferrer",children:"B\u1ea5m v\xe0o \u0111\xe2y"})]}),Object(u.jsxs)("p",{children:["(G\u1eedi l\xfac ",g.a.getTimeStr(t.created)," ng\xe0y ",g.a.getDateStr(t.created),")",!!t.org&&Object(u.jsxs)("span",{children:[Object(u.jsx)("br",{}),"\u0110\u01a1n v\u1ecb t\u1ed5 ch\u1ee9c: ",g.a.getOrgName(t)]})]}),!this.props.admin&&!!t.feedback&&Object(u.jsxs)("p",{children:["\u25cf C\xe2u h\u1ecfi, g\xf3p \xfd: ",t.feedback]})]})}_renderMainCard(){const{doc:t}=this.props,{isExpanded:e,copyContent:n,publishAction:s,isNoteEditOpen:i}=this.state,c=this.props.gotoPublish||(()=>{}),l=Object(u.jsxs)("div",{children:[Object(u.jsxs)("div",{style:e?null:{maxHeight:"315px",overflow:"hidden",position:"relative"},className:e?null:"fade-out",children:[!this.props.admin&&this._renderNonAdminInfo(),Object(u.jsxs)("p",{children:[t.approved&&Object(u.jsx)(v.a,{size:"small",color:"primary",style:{marginRight:"15px"},disabled:!0,children:Object(u.jsx)(w.a,{})}),this._renderDuplicatedWarningIcon(),Object(u.jsxs)("b",{children:["-- ",t.name," --"]}),t.plan&&Object(u.jsx)("p",{children:Object(u.jsxs)("span",{className:"doc-plan",children:["\u2588 G\xf3i ",t.plan.toUpperCase()]})})]}),Object(u.jsx)(f.a,{componentDecorator:(t,e,n)=>Object(u.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:e},n),children:this._renderPostContent()})]}),this.props.admin&&Object(u.jsx)("div",{children:Object(u.jsx)("center",{children:Object(u.jsx)(d.a,{onClick:()=>this.setState({isExpanded:!e}),children:e?"Thu g\u1ecdn":"Hi\u1ec7n th\xeam ..."})})}),Object(u.jsx)(k.a,{}),this.props.admin&&Object(u.jsx)(a.a.Fragment,{children:this.state.loading?Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})}):Object(u.jsxs)("div",{children:[t.comment&&t.comment.trim().length>0&&Object(u.jsxs)("p",{children:[Object(u.jsx)("b",{children:"\u25cf Ghi ch\xfa:"})," ",g.a.nl2br(t.comment)]}),!!t.feedback&&Object(u.jsxs)("p",{children:["\u25cf C\xe2u h\u1ecfi, g\xf3p \xfd: ",t.feedback]}),Object(u.jsx)(d.a,{variant:"outlined",onClick:this.toggleTrashDoc.bind(this),color:"primary",children:"X\xf3a"}),Object(u.jsx)(d.a,{variant:"outlined",onClick:this.toggleApproved.bind(this),color:"primary",children:"Tick"}),s&&Object(u.jsx)(d.a,{variant:"outlined",onClick:()=>{c({id:t.id,caption:n,url:this.getImageUrl(),fbusername:this.fbusername,psid:t.psid,feedback:t.feedback},s)},color:"primary",children:"\u0110\u0103ng b\xe0i"}),Object(u.jsx)(d.a,{variant:"outlined",onClick:()=>this.setState({isNoteEditOpen:!0}),color:"primary",children:"Ghi ch\xfa"}),Object(u.jsx)(d.a,{variant:"outlined",onClick:()=>this.props.openToolsDialog(t),color:"primary",children:"+"})]})})]});return Object(u.jsxs)("div",{style:{paddingBottom:"20px"},children:[Object(u.jsx)(o.a,{children:Object(u.jsx)(r.a,{style:{backgroundColor:t.approved&&this.props.admin?"#cfd8dc":"#fff"},className:t.approved&&this.props.admin?"approved":null,children:l})}),i&&Object(u.jsx)(B,{doc:t,onClose:t=>{this.setState({isNoteEditOpen:!1}),!1!==t&&this.updateComment(t)}})]})}_renderTrashedDoc(){const{doc:t}=this.props;return this.state.loading?Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})}):Object(u.jsxs)("p",{children:[Object(u.jsx)("b",{children:"(\u0110\xe3 x\xf3a)"})," ",t.name," \xa0\xa0\xa0",Object(u.jsx)(d.a,{variant:"outlined",size:"small",color:"primary",className:"restore-btn",onClick:this.toggleTrashDoc.bind(this),children:"Kh\xf4i ph\u1ee5c"})]})}render(){const{doc:t,admin:e}=this.props;return t.trashed&&e?this._renderTrashedDoc():this._renderMainCard()}}var P=A,M=n(353),L=n(364),H=n(365),F=n(247);n(251);const R=[{desc:"B\xe1o tr\xf9ng b\xe0i",text:"\u0110\xe3 c\xf3 ng\u01b0\u1eddi nh\u1eadp th\xf4ng tin c\u1ee7a d\u1ef1 \xe1n / cu\u1ed9c thi / s\u1ef1 ki\u1ec7n n\xe0y. Kh\xf4ng bi\u1ebft b\u1ea1n c\xf3 mu\u1ed1n b\u1ed5 sung hay thay \u0111\u1ed5i g\xec kh\xf4ng nh\u1ec9?\n\nN\u1ebfu kh\xf4ng, ch\xfang m\xecnh s\u1ebd x\xf3a th\xf4ng tin b\u1ea1n \u0111\xe3 nh\u1eadp \u0111\u1ec3 kh\xf4ng b\u1ecb tr\xf9ng v\u1edbi b\xe0i \u0111\xe3 \u0111\u0103ng."},{desc:"B\xe1o b\u1ecb x\xf3a v\xec ko ph\xf9 h\u1ee3p",text:"Xin ch\xe0o b\u1ea1n,\n\nD\u1ef1 \xe1n / cu\u1ed9c thi / s\u1ef1 ki\u1ec7n c\u1ee7a b\u1ea1n \u0111\xe3 b\u1ecb x\xf3a do kh\xf4ng ph\xf9 h\u1ee3p v\u1edbi \u0110i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng c\u1ee7a ch\xfang m\xecnh.\n\nH\xe3y tham kh\u1ea3o \u0110i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng c\u1ee7a fanpage t\u1ea1i \u0111\xe2y: https://sites.google.com/view/tonghopevent"},{desc:"B\xe1o d\u1ef1 \xe1n c\xf3 l\u1ee3i nhu\u1eadn",text:"Xin ch\xe0o b\u1ea1n,\n\nD\u1ef1 \xe1n / cu\u1ed9c thi / s\u1ef1 ki\u1ec7n c\u1ee7a b\u1ea1n \u0111\u01b0\u1ee3c \u0111i\u1ec1u h\xe0nh b\u1edfi m\u1ed9t t\u1ed5 ch\u1ee9c / c\xe1 nh\xe2n ho\u1ea1t \u0111\u1ed9ng c\xf3 l\u1ee3i nhu\u1eadn. D\u1ef1a theo \u0110i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng c\u1ee7a ch\xfang m\xecnh, b\xe0i c\u1ee7a b\u1ea1n ph\u1ea3i tr\u1ea3 ph\xed 100.000 VN\u0110 \u0111\u1ec3 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c \u0111\u0103ng b\xe0i l\xean fanpage nh\xe9.\n\nH\xe3y tham kh\u1ea3o \u0110i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng c\u1ee7a fanpage t\u1ea1i \u0111\xe2y: https://sites.google.com/view/tonghopevent"},{desc:"B\xe1o thi\u1ebfu th\xf4ng tin",text:"Admin \u0111\xe3 xem b\xe0i vi\u1ebft c\u1ee7a b\u1ea1n. Tuy nhi\xean, do b\xe0i vi\u1ebft c\u1ee7a b\u1ea1n c\xf2n thi\u1ebfu m\u1ed9t s\u1ed1 th\xf4ng tin n\xean ch\xfang m\xecnh ch\u01b0a th\u1ec3 ph\xea duy\u1ec7t \u0111\u01b0\u1ee3c. B\u1ea1n h\xe3y \u0111i\u1ec1n l\u1ea1i form v\u1edbi \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin h\u01a1n nh\xe9!\n\nH\xe3y tham kh\u1ea3o v\xed d\u1ee5 sau: https://bit.ly/2TZKbee"},{desc:"\u0110i\u1ec1n l\u1ea1i (kh\xf4ng paste link)",text:"Admin \u0111\xe3 xem b\xe0i vi\u1ebft c\u1ee7a b\u1ea1n. Tuy nhi\xean, ch\xfang m\xecnh kh\xf4ng th\u1ec3 x\u1eed l\xfd n\u1ebfu b\u1ea1n ch\u1ec9 copy-paste m\u1ed7i link b\xe0i vi\u1ebft. B\u1ea1n h\xe3y \u0111i\u1ec1n l\u1ea1i form th\u1eadt r\xf5 r\xe0ng, bao g\u1ed3m c\u1ea3 ph\u1ea7n gi\u1edbi thi\u1ec7u, \xfd ngh\u0129a d\u1ef1 \xe1n / cu\u1ed9c thi / s\u1ef1 ki\u1ec7n nh\xe9.\n\nH\xe3y tham kh\u1ea3o v\xed d\u1ee5 sau: https://bit.ly/2TZKbee"}];class K extends a.a.Component{constructor(t){super(t),this.state={loading:!0,error:!1,showTemplates:!0,sendInboxData:null,inboxData:{},isLinkCopied:!1}}async fetchData(){this.setState({error:!1,loading:!0,showTemplates:!0,isLinkCopied:!1});const t=await g.a.makeRequest("".concat(p.a.BACKEND,"/inbox/").concat(this.props.psid)),{data:e}=t;e&&Object.keys(e).length>0?this.setState({loading:!1,error:!1,inboxData:e}):this.setState({loading:!1,error:!0})}async sendInbox(){const t=(e=this.state.sendInboxData,JSON.parse(JSON.stringify(e)));var e;this.setState({sendInboxData:null}),this.props.closeToolsDialog();const n=await g.a.makeRequest("".concat(p.a.BACKEND,"/inbox/").concat(this.props.psid),"post",{message:"\u2b22 "+t.text});n.data&&n.data.success?window.toastr.success("\u0110\xe3 g\u1eedi tin nh\u1eafn th\xe0nh c\xf4ng!"):window.toastr.error("\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f C\xf3 l\u1ed7i x\u1ea3y ra, ko th\u1ec3 g\u1eedi tin nh\u1eafn \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f")}goToPageInbox(){g.a.goToInbox(this.state.inboxData),this.props.closeToolsDialog()}_renderSendInboxDialogAsk(){const{sendInboxData:t}=this.state,e=Date.now()-this.props.doc.created<864e5,n=()=>this.setState({sendInboxData:null});return t?Object(u.jsxs)(_.a,{open:!!t,onClose:n,children:[Object(u.jsx)(S.a,{id:"alert-dialog-title",children:t.desc}),Object(u.jsx)(I.a,{children:Object(u.jsxs)(N.a,{id:"alert-dialog-description",children:[e?"G\u1eedi tin nh\u1eafn c\xf3 n\u1ed9i dung nh\u01b0 sau (c\xf3 th\u1ec3 s\u1eeda):":"Kh\xf4ng th\u1ec3 t\u1ef1 \u0111\u1ed9ng g\u1eedi tin nh\u1eafn. H\xe3y copy-paste v\xe0 inbox th\u1ee7 c\xf4ng:",Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(l.a,{multiline:!0,rowsMax:"20",value:t.text,onChange:e=>{this.setState({sendInboxData:{...t,text:e.target.value}})},margin:"normal",variant:"outlined",fullWidth:!0})]})}),Object(u.jsxs)(T.a,{children:[Object(u.jsx)(d.a,{onClick:n,color:"primary",children:" Quay l\u1ea1i "}),!e&&Object(u.jsx)(d.a,{onClick:()=>g.a.copyTextToClipboard(t.text),color:"primary",children:" Copy tin nh\u1eafn "}),e?Object(u.jsx)(d.a,{onClick:()=>this.sendInbox(),color:"primary",children:" G\u1eecI "}):Object(u.jsx)(d.a,{onClick:()=>this.goToPageInbox(),color:"primary",children:" \u0110i t\u1edbi inbox "})]})]}):null}_renderError(){return Object(u.jsxs)(M.a,{children:[Object(u.jsx)(L.a,{button:!0,children:Object(u.jsx)(H.a,{primary:"(C\xf3 l\u1ed7i x\u1ea3y ra)"})}),Object(u.jsx)(L.a,{button:!0,onClick:this.props.closeToolsDialog,children:Object(u.jsx)(H.a,{primary:"Quay l\u1ea1i"})})]})}_renderContent(){const{inboxData:t,showTemplates:e,isLinkCopied:n}=this.state;return Object(u.jsxs)(M.a,{children:[Object(u.jsx)(L.a,{button:!0,onClick:this.goToPageInbox.bind(this),children:Object(u.jsx)(H.a,{primary:"\u0110i t\u1edbi inbox",secondary:"T\xean FB: ".concat(t.senders.data[0].name)})}),Object(u.jsx)(k.a,{}),!e&&Object(u.jsx)(L.a,{button:!0,onClick:()=>this.setState({showTemplates:!0}),children:Object(u.jsx)(H.a,{primary:"\ud83d\udcac (Hi\u1ec7n c\xe1c m\u1eabu tin nh\u1eafn)"})}),e&&R.map(((t,e)=>Object(u.jsx)(L.a,{button:!0,onClick:()=>this.setState({sendInboxData:t}),children:Object(u.jsx)(H.a,{primary:"\ud83d\udcac ".concat(t.desc)})},e))),Object(u.jsx)(k.a,{}),Object(u.jsx)(F.CopyToClipboard,{text:"".concat(window.location.protocol,"//").concat(window.location.host,"/data/#/view/").concat(this.props.doc.id),onCopy:()=>this.setState({isLinkCopied:!0}),children:Object(u.jsx)(L.a,{button:!0,children:Object(u.jsx)(H.a,{primary:n?"(\u0110\xe3 copy link)":"Copy link b\xe0i vi\u1ebft"})})}),Object(u.jsx)(k.a,{}),Object(u.jsx)(L.a,{button:!0,onClick:this.props.closeToolsDialog,children:Object(u.jsx)(H.a,{primary:"Quay l\u1ea1i"})})]})}render(){const{name:t,open:e}=this.props;return Object(u.jsxs)(a.a.Fragment,{children:[this._renderSendInboxDialogAsk(),Object(u.jsxs)(_.a,{open:e,onEnter:this.fetchData.bind(this),onBackdropClick:this.props.closeToolsDialog,className:"tools-dialog","aria-labelledby":"simple-dialog-title",children:[Object(u.jsx)(S.a,{id:"simple-dialog-title",children:t?t.substr(0,24):""}),this.state.loading?Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})}):this.state.error?this._renderError():this._renderContent()]})]})}}var U=K;class W extends a.a.Component{constructor(t){super(t),this.state={}}_renderContent(){const{docs:t,selectedDocID:e}=this.props,n=Date.now();return Object(u.jsxs)(M.a,{children:[t.map((t=>{if(t.id===e)return null;const s=Math.floor((n-t.created)/86400/1e3);return Object(u.jsx)(L.a,{button:!0,onClick:()=>window.open("/data/#/view/".concat(t.id),"_blank"),children:Object(u.jsx)(H.a,{primary:t.name,secondary:"".concat(g.a.getDateStr(t.created)," l\xfac ").concat(g.a.getTimeStr(t.created)," ").concat(s>0?" (".concat(s," ng\xe0y tr\u01b0\u1edbc)"):"")})},t.id)})),Object(u.jsx)(k.a,{}),Object(u.jsx)(L.a,{button:!0,onClick:this.props.closeDuplicateDocDialog,children:Object(u.jsx)(H.a,{primary:"Quay l\u1ea1i"})})]})}render(){const{docs:t}=this.props;return Object(u.jsxs)(_.a,{open:!!t,"aria-labelledby":"simple-dialog-title",children:[Object(u.jsx)(S.a,{id:"simple-dialog-title",children:"B\xe0i \u0111\u0103ng tr\xf9ng"}),Object(u.jsx)(I.a,{children:"B\xe0i \u0111\u0103ng n\xe0y c\xf3 th\u1ec3 b\u1ecb tr\xf9ng v\u1edbi nh\u1eefng b\xe0i sau:"}),t&&this._renderContent()]})}}var G=W;var V=class{constructor(){this.seen={}}pushLookbackData(t){for(const e of t){const{fbname:t}=e;this.seen[t]?this.seen[t].push(e):this.seen[t]=[e]}}pushDoc(t){const e=g.a.extractFacebookUsername(t.linkfb);if(!e)return null;this.seen[e]?this.seen[e].push(t):this.seen[e]=[t]}checkDoc(t){const e=g.a.extractFacebookUsername(t.linkfb),n=this.seen[e];return n&&n.length>1?n:null}clear(){this.seen={}}},z=n(201);class J extends a.a.Component{constructor(t){super(),this.markDocApproved=t=>{window.DOCID_APPROVED||(window.DOCID_APPROVED={}),window.DOCID_APPROVED[t]=!0,this.dispatchDocApproved()},this.dispatchDocApproved=()=>{window.DOCID_APPROVED||(window.DOCID_APPROVED={}),this.setState((t=>({list:t.list.map((t=>(window.DOCID_APPROVED[t.id]&&(t.approved=!0),t)))})))},this.handleChange=t=>e=>{this.setState({[t]:e.target.value})},this.props=t,this.state={loading:!0,list:[],toolsDialogOpen:!1,toolsDialogDoc:{},duplicateHelper:new V,duplicateDocDialog:null,selectedDocID:""},window.changeHeader("Qu\u1ea3n l\xfd d\u1eef li\u1ec7u - TongHopEvent")}componentDidMount(){this.loadData(),window.markDocApproved=this.markDocApproved}componentWillUnmount(){window.markDocApproved=null}async loadData(){const t=new V,e=g.a.getToken(),[n,{data:s}]=await Promise.all([b.a.get("".concat(p.a.BACKEND,"/feed?token=").concat(e)),b.a.get("".concat(p.a.BACKEND,"/lookback?token=").concat(e))]);g.a.checkError(n),t.pushLookbackData(s),this.setState({loading:!1,list:n.data,duplicateHelper:t}),this.dispatchDocApproved()}onClickEdit(){this.setState({edit:!0})}setDoc(t,e){this.setState((n=>{const s=n.list;return s[t]=e,{list:s}}))}openToolsDialog(t){this.setState({toolsDialogOpen:!0,toolsDialogDoc:t})}openDuplicateDocDialog(t,e){this.setState({duplicateDocDialog:t,selectedDocID:e})}render(){const t=Object(u.jsxs)("div",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})})]}),{gotoPublish:e}=this.props,{duplicateDocDialog:n,duplicateHelper:s,selectedDocID:i}=this.state,o=Object(u.jsxs)(a.a.Fragment,{children:[Object(u.jsxs)("div",{style:{marginTop:"20px",marginRight:"20px",marginLeft:"20px"},children:[0===this.state.list.length&&Object(u.jsx)("center",{children:Object(u.jsx)("h2",{children:"Ch\u01b0a c\xf3 b\xe0i \u0111\u0103ng n\xe0o"})}),Object(u.jsx)(z.a,{columnsCountBreakPoints:{350:1,1e3:2,1550:3},children:Object(u.jsx)(z.b,{gutter:"10px",children:this.state.list.map(((t,n)=>t?Object(u.jsx)("div",{children:Object(u.jsx)(P,{doc:t,setDoc:this.setDoc.bind(this),i:n,admin:!0,gotoPublish:e,openToolsDialog:this.openToolsDialog.bind(this),openDuplicateDocDialog:this.openDuplicateDocDialog.bind(this),duplicateHelper:s})},t.id):null))})})]}),Object(u.jsx)(U,{open:this.state.toolsDialogOpen,closeToolsDialog:()=>this.setState({toolsDialogOpen:!1}),name:this.state.toolsDialogDoc.name,psid:this.state.toolsDialogDoc.psid,doc:this.state.toolsDialogDoc}),Object(u.jsx)(G,{docs:n,selectedDocID:i,closeDuplicateDocDialog:()=>this.setState({duplicateDocDialog:null})})]});return this.state.loading?t:o}}var X=J;const Y={cardStyle:{maxWidth:"800px",marginTop:"20px",marginRight:"auto",marginLeft:"auto"}};class Q extends a.a.Component{constructor(t){super(),this.props=t,this.state={loading:!0,doc:{}},window.changeHeader("Qu\u1ea3n l\xfd d\u1eef li\u1ec7u - TongHopEvent")}componentDidMount(){this.loadData()}async loadData(){const t=g.a.getLocalStorage("token"),e=await b.a.get("".concat(p.a.BACKEND,"/doc/").concat(this.props.id,"?token=").concat(t));e.data.error?this.setState({loading:!1,doc:null}):this.setState({loading:!1,doc:e.data})}_renderDocView(){return Object(u.jsx)("div",{style:Y.cardStyle,children:Object(u.jsx)(P,{doc:this.state.doc||{}})})}_renderDocNotFound(){return Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("h2",{children:"C\xf3 l\u1ed7i x\u1ea3y ra"}),"B\xe0i \u0111\u0103ng n\xe0y kh\xf4ng t\u1ed3n t\u1ea1i ho\u1eb7c \u0111\xe3 b\u1ecb xo\xe1",Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}render(){const t=Object(u.jsxs)("div",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})})]});return this.state.loading?t:this.state.doc?this._renderDocView():this._renderDocNotFound()}}var q=Q,Z=n(162),$=n.n(Z),tt=n(297),et=n(298);class nt extends a.a.Component{constructor(t){super(t),this.state={publish_time:new Date(Date.now()+12e5)}}componentDidMount(){this.props.handleDateChange(this.state.publish_time.getTime()/1e3)}handleDateChange(t){this.setState({publish_time:t}),this.props.handleDateChange(t.getTime()/1e3)}render(){const{publish_time:t}=this.state;return Object(u.jsxs)(et.c,{utils:tt.a,children:[Object(u.jsx)(et.a,{margin:"normal",id:"mui-pickers-date",label:"Date picker",value:t,onChange:this.handleDateChange.bind(this),KeyboardButtonProps:{"aria-label":"change date"}}),"\xa0\xa0\xa0\xa0\xa0",Object(u.jsx)(et.b,{margin:"normal",id:"mui-pickers-time",label:"Time picker",value:t,onChange:this.handleDateChange.bind(this),KeyboardButtonProps:{"aria-label":"change time"}})]})}}var st=nt;const at=864e5,it=6e5,ot=-252e5,ct=[{hrs:6,min:0,priority:3},{hrs:6,min:20,priority:2},{hrs:6,min:40,priority:1},{hrs:7,min:0,priority:1},{hrs:19,min:0,priority:3},{hrs:19,min:30,priority:4},{hrs:20,min:0,priority:7},{hrs:20,min:30,priority:7},{hrs:20,min:45,priority:4},{hrs:21,min:0,priority:9},{hrs:21,min:15,priority:4},{hrs:21,min:30,priority:8},{hrs:21,min:50,priority:4},{hrs:22,min:10,priority:1}].map((t=>({...t,timeInDay:1e3*(3600*t.hrs+60*t.min)}))),rt=t=>{const e=t.match(/([0-9]+)\/([0-9]+)/);if(console.log(e),!e)return 0;const n=new Date(2021,parseInt(e[2])-1,parseInt(e[1]),0,0,0,0);return n.setTime(n.getTime()+6e4*n.getTimezoneOffset()-ot),console.log(n),n.getTime()},lt=t=>{let{stat:e}=t;const n=JSON.parse(JSON.stringify(e)).sort();return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("p",{children:Object(u.jsx)("b",{children:"C\xe1c b\xe0i \u0111\u0103ng \u0111\xe3 l\xean l\u1ecbch"})}),Object(u.jsx)("ul",{children:n.map((t=>Object(u.jsxs)("li",{children:[g.a.getTimeStr(t)," ng\xe0y ",g.a.getDateStr(t)]},t)))})]})},dt=t=>{let{statArr:e,value:n,onChange:i,feedback:o}=t;const[c,r]=Object(s.useState)(!1),[l,h]=Object(s.useState)(!1),[j]=Object(s.useState)((()=>{const t=Date.now(),e=Math.floor(t/at)*at,n=[];let s=0;for(;n.length<7;){const a=e+s*at+ot,i=[];for(const e of ct){const n=a+e.timeInDay;n-t>12e5&&i.push({...e,time:n})}i.length>2&&n.push({startAt:a-ot,slotsOfDay:i}),s++}return n})()),[b,p]=Object(s.useState)({}),[x,m]=Object(s.useState)(null),O=1e3*n;return Object(s.useEffect)((()=>{const t=JSON.parse(JSON.stringify(e)),n=((t,e)=>{const n={};for(const{slotsOfDay:s}of e)for(const{time:e}of s)t.some((t=>t-it<e&&e<t+it))&&(n[e]=!0);return n})(t,j);p(n),console.log({stat:t,timeslots:j,takenSlots:n,feedback:o});const s=((t,e,n)=>{const s=rt(n),a=JSON.parse(JSON.stringify(t));for(const{slotsOfDay:i}of a){i.sort(((t,e)=>t.priority<e.priority?1:-1));for(const{time:t}of i)if(!e[t]&&t>s)return t}return null})(j,n,o);s&&(m(s),setTimeout((()=>i(Math.round(s/1e3))),200))}),[e]),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("p",{children:[Object(u.jsx)("b",{children:"L\xean l\u1ecbch b\xe0i \u0111\u0103ng"}),"   ",Object(u.jsx)(d.a,{variant:"outlined",size:"small",onClick:()=>r(!c),children:c?"Ch\u1ecdn gi\u1edd theo slot":"Ch\u1ecdn gi\u1edd th\u1ee7 c\xf4ng"})]}),o&&Object(u.jsxs)("p",{children:["G\xf3p \xfd t\u1eeb ng\u01b0\u1eddi g\u1eedi: ",o]}),!c&&Object(u.jsxs)(u.Fragment,{children:[x&&Object(u.jsxs)("p",{children:["Gi\u1edd \u0111\u0103ng b\xe0i do m\xe1y g\u1ee3i \xfd: ",g.a.getTimeStr(x,7)," ng\xe0y ",g.a.getDateStr(x,7)]}),j.map(((t,e)=>!l&&e<3||l?Object(u.jsxs)("p",{children:[Object(u.jsx)("b",{children:g.a.getDateStr(t.startAt,7)})," (GMT+7)",Object(u.jsx)("br",{}),t.slotsOfDay.map((t=>{let{time:e}=t;return Object(u.jsxs)(a.a.Fragment,{children:[Object(u.jsx)(d.a,{variant:"outlined",size:"small",color:"primary",className:O===e?"timeslot-selected":"",onClick:()=>i(Math.round(e/1e3)),disabled:b[e],children:g.a.getTimeStr(e,7)}),"  "]},e)}))]},t.startAt):null)),!l&&Object(u.jsx)(d.a,{variant:"outlined",size:"small",color:"primary",onClick:()=>h(!0),children:"+ Hi\u1ec7n th\xeam ng\xe0y"})]}),c&&Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(st,{handleDateChange:t=>i(Math.round(t))}),Object(u.jsx)(lt,{stat:e})]})]})},ht={cardStyle:{marginTop:"20px",marginRight:"1em",marginLeft:"1em",display:"flex",flexWrap:"wrap"}};class jt extends a.a.Component{constructor(t){super(t),this.getErrorMessage=t=>{var e;return(null===t||void 0===t||null===(e=t.error)||void 0===e?void 0:e.message)?"L\xfd do: "+t.error.message:"H\xe3y b\xe1o l\u1ea1i cho Nui."},this.state={completed:!1,loading:!0,stat:null,inboxData:null},t.data&&(this.state.id=t.data.id,this.state.caption=t.data.caption,this.state.url=t.data.url,this.state.psid=t.data.psid,this.state.feedback=t.data.feedback||"",this.state.scheduled_publish_time=0),window.changeHeader("C\xf4ng c\u1ee5 \u0111\u0103ng b\xe0i - TongHopEvent")}componentDidMount(){this.loadStat(),this.loadInbox()}async loadStat(){const t=g.a.getLocalStorage("token"),e=await b.a.get("".concat(p.a.BACKEND,"/publish/stat?token=").concat(t));e.data.error?this.setState({loading:!1,stat:[]}):this.setState({loading:!1,stat:e.data})}async loadInbox(){const{data:t}=await g.a.makeRequest("".concat(p.a.BACKEND,"/inbox/").concat(this.state.psid));t&&Object.keys(t).length>0&&this.setState({inboxData:t})}async doPublish(){const t=g.a.getLocalStorage("token"),e=this.state.id,n={caption:this.state.caption,url:this.state.url,scheduled_publish_time:this.state.scheduled_publish_time},s=window.toastr.info("\u0110ang \u0111\u0103ng b\xe0i...","Publish tool",{timeOut:6e4});window.location.hash="#/manage";const{data:a}=await b.a.post("".concat(p.a.BACKEND,"/publish?token=").concat(t),n);window.toastr.clear(s),a.id?(window.toastr.success("\u0110\xe3 \u0111\u0103ng b\xe0i th\xe0nh c\xf4ng!","Publish tool"),window.markDocApproved&&window.markDocApproved(e)):window.toastr.error("L\u1ed7i: Kh\xf4ng th\u1ec3 \u0111\u0103ng b\xe0i. "+this.getErrorMessage(a),"Publish tool",{timeOut:2e4})}_renderComposerCard(){const t={height:"300px",maxWidth:"100%"};return Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[Object(u.jsxs)("p",{children:[Object(u.jsx)(d.a,{variant:"outlined",size:"small",onClick:()=>window.location.hash="#/manage",children:"Tr\u1edf v\u1ec1"}),"\xa0\xa0\xa0",Object(u.jsx)("b",{children:"So\u1ea1n b\xe0i \u0111\u0103ng"})]}),Object(u.jsx)("center",{children:Object(u.jsx)($.a,{alt:"",src:this.state.url,style:t,loader:Object(u.jsx)("div",{style:t,children:Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(h.a,{})]})})})}),Object(u.jsx)(l.a,{label:"N\u1ed9i dung b\xe0i \u0111\u0103ng",multiline:!0,rowsMax:"20",value:this.state.caption,onChange:t=>{this.setState({caption:t.target.value})},margin:"normal",variant:"outlined",fullWidth:!0})]})})}_renderPublishCard(){const{scheduled_publish_time:t,stat:e,feedback:n}=this.state,s=t-Date.now()/1e3>900,a=1e3*t;return Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[e&&Object(u.jsx)(dt,{value:t,statArr:e,onChange:t=>this.setState({scheduled_publish_time:t}),feedback:n}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),s&&Object(u.jsx)(d.a,{variant:"contained",color:"primary",onClick:()=>{window.showAlert({title:"X\xe1c nh\u1eadn \u0111\u0103ng b\xe0i",text:"\u0110\u0103ng b\xe0i v\xe0o l\xfac ".concat(g.a.getTimeStr(a)," ng\xe0y ").concat(g.a.getDateStr(a)," ?"),onClickOK:this.doPublish.bind(this),showCancel:!0})},children:"\u0110\u0103ng b\xe0i"}),!s&&t>0&&Object(u.jsx)("p",{style:{color:"red"},children:"Gi\u1edd \u0111\u0103ng b\xe0i ph\u1ea3i c\xe1ch hi\u1ec7n t\u1ea1i \xedt nh\u1ea5t 15 ph\xfat"})]})})}_renderCompletedCard(){const{scheduled_publish_time:t}=this.state,e=1e3*t;return Object(u.jsxs)("div",{style:ht.cardStyle,children:[Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[Object(u.jsx)("h2",{children:"\u0110\u0103ng b\xe0i th\xe0nh c\xf4ng"}),Object(u.jsxs)("p",{children:["B\xe0i vi\u1ebft \u0111\xe3 \u0111\u01b0\u1ee3c \u0111\u1eb7t gi\u1edd \u0111\u1ec3 \u0111\u0103ng v\xe0o l\xfac ",g.a.getTimeStr(e)," ng\xe0y ",g.a.getDateStr(e)]}),Object(u.jsx)(d.a,{variant:"outlined",onClick:()=>window.location.hash="#/",children:"Tr\u1edf v\u1ec1 trang ch\u1ee7"})]})}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}_renderInboxCard(){const{inboxData:t}=this.state;return Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[!t&&Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})}),t&&Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("b",{children:"Tin nh\u1eafn m\u1edbi nh\u1ea5t (\u1edf tr\xean l\xe0 m\u1edbi, d\u01b0\u1edbi l\xe0 c\u0169)"}),"   ",Object(u.jsx)(d.a,{variant:"outlined",size:"small",onClick:()=>g.a.goToInbox(t),children:"M\u1edf inbox"}),Object(u.jsx)("br",{}),"------",Object(u.jsx)("br",{}),t.messages.data.map((t=>Object(u.jsxs)("p",{children:[Object(u.jsx)("b",{children:t.from.name}),": ",t.message]},t.id)))]})]})})}_renderMain(){return Object(u.jsxs)("div",{style:{margin:"20px"},children:[Object(u.jsx)(z.a,{columnsCountBreakPoints:{350:1,750:2,900:2},children:Object(u.jsxs)(z.b,{gutter:"10px",children:[this._renderComposerCard(),Object(u.jsx)("div",{})," ",this._renderPublishCard(),this._renderInboxCard()]})}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}_renderError(){return Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("h2",{children:"C\xf3 l\u1ed7i x\u1ea3y ra"}),"H\xe3y v\xe0o trang ch\u1ee7 v\xe0 th\u1eed l\u1ea1i",Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}render(){const t=Object(u.jsxs)("div",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})})]});return this.state.loading?t:this.state.completed?this._renderCompletedCard():this.props.data?this._renderMain():this._renderError()}}var bt=jt;const pt={maxHeight:"300px",maxWidth:"100%"},gt={height:"300px",width:"100%"},ut={cardStyle:{maxWidth:"800px",marginTop:"20px",marginRight:"auto",marginLeft:"auto"}};class xt extends a.a.Component{constructor(t){super(t),this.state={showGetToken:!1,access_token:"",completed:!1,loading:!0,imgs:[]},t.data?(this.state.caption=t.data.caption,this.state.fbusername=t.data.fbusername):this.state.error="H\xe3y v\u1ec1 trang ch\u1ee7 v\xe0 th\u1eed l\u1ea1i",window.changeHeader("Ch\u1ecdn \u1ea3nh b\xe0i \u0111\u0103ng - TongHopEvent")}componentDidMount(){this.fetchFacebookApi()}async fetchFacebookApi(){const t=g.a.getLocalStorage("fbtoken");try{const e=await b.a.get("https://graph.facebook.com/".concat(this.state.fbusername,"?fields=feed.limit(20)%7Bfull_picture%7D%2Cpicture.width(720)%7Burl%7D&access_token=").concat(t));if(e.data.error)this.setState({loading:!1,showGetToken:!0});else{const t=e.data.feed.data.map((t=>t.full_picture));t.unshift(e.data.picture.data.url),this.setState({loading:!1,showGetToken:!1,imgs:t})}}catch(e){404===e.response.status?this.setState({loading:!1,error:"Kh\xf4ng th\u1ec3 m\u1edf trang facebook n\xe0y"}):this.setState({loading:!1,showGetToken:!0})}}onSaveToken(){let t=this.state.access_token;t=t.match(/EA[a-zA-Z0-9]+/);try{g.a.setLocalStorage("fbtoken",t[0]);const e=window.location.hash;window.location.hash="#/reload",setTimeout((()=>{window.location.hash=e}),50)}catch(e){window.alert("token kh\xf4ng h\u1ee3p l\u1ec7")}}_renderTitleCard(){return Object(u.jsx)(o.a,{children:Object(u.jsx)(r.a,{children:Object(u.jsxs)("p",{children:[Object(u.jsx)(d.a,{variant:"outlined",size:"small",onClick:()=>window.location.hash="#/",children:"Tr\u1edf v\u1ec1"}),"\xa0\xa0\xa0",Object(u.jsx)("b",{children:"Ch\u1ecdn \u1ea3nh cho b\xe0i \u0111\u0103ng"})]})})})}_renderImageCard(t){return Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[Object(u.jsx)("center",{children:Object(u.jsx)($.a,{alt:"",src:t,style:pt,loader:Object(u.jsx)("div",{style:gt,children:Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(h.a,{})]})})})}),Object(u.jsx)(d.a,{variant:"outlined",size:"small",style:{float:"right",margin:"10px"},onClick:()=>{const e=JSON.parse(JSON.stringify(this.props.data));e.url=t,this.props.gotoPublish(e,"publish")},children:"Ch\u1ecdn \u1ea3nh n\xe0y"})]})})}_renderGetTokenCard(){return Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[Object(u.jsxs)("p",{children:[Object(u.jsx)(d.a,{variant:"outlined",size:"small",onClick:()=>window.location.hash="#/",children:"Tr\u1edf v\u1ec1"}),"\xa0\xa0\xa0",Object(u.jsx)("b",{children:"L\u1ea5y token"}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),"B\u1ea1n ch\u01b0a c\xf3 token ho\u1eb7c token \u0111\xe3 b\u1ecb h\u1ebft h\u1ea1n. H\xe3y l\xe0m theo h\u01b0\u1edbng d\u1eabn n\xe0y \u0111\u1ec3 l\u1ea5y token: ",Object(u.jsx)("a",{href:"https://blog.ngxson.com/tonghopevent/#lay-token",target:"_blank",rel:"noopener noreferrer",children:"[B\u1ea5m v\xe0o \u0111\xe2y]"}),Object(u.jsx)("br",{}),"L\u01b0u \xfd: token s\u1ebd \u0111c l\u01b0u tr\xean m\xe1y n\xe0y. B\u1ea1n c\xf3 th\u1ec3 l\u1ea5y token t\u1eeb m\xe1y t\xednh \u0111\u1ec3 d\xf9ng tr\xean \u0110T.",Object(u.jsx)("br",{}),"\u0110i\u1ec1n token c\u1ee7a b\u1ea1n v\xe0o \xf4 d\u01b0\u1edbi \u0111\xe2y:",Object(u.jsx)("br",{})]}),Object(u.jsx)(l.a,{multiline:!0,rowsMax:"5",value:this.state.access_token,onChange:t=>{this.setState({access_token:t.target.value})},margin:"normal",variant:"outlined",fullWidth:!0}),Object(u.jsx)("br",{}),Object(u.jsx)(d.a,{variant:"outlined",onClick:this.onSaveToken.bind(this),children:"Ti\u1ebfp t\u1ee5c"})]})})}_renderMain(){return Object(u.jsxs)(a.a.Fragment,{children:[this.state.showGetToken&&Object(u.jsx)("div",{style:ut.cardStyle,children:this._renderGetTokenCard()}),!this.state.showGetToken&&Object(u.jsx)("div",{style:ut.cardStyle,children:this._renderTitleCard()}),!this.state.showGetToken&&this.state.imgs.map(((t,e)=>Object(u.jsx)("div",{style:ut.cardStyle,children:this._renderImageCard(t)},e))),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}_renderError(){return Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("h2",{children:"C\xf3 l\u1ed7i x\u1ea3y ra"}),this.state.error,Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(d.a,{variant:"outlined",size:"small",onClick:()=>window.location.hash="#/",children:"Tr\u1edf v\u1ec1"}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}render(){const t=Object(u.jsxs)("div",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})})]});return this.state.loading?t:this.state.error?this._renderError():this._renderMain()}}var mt=xt,Ot=(n(163),n(164),n(149)),ft=n(166),vt=n(200),kt=n.n(vt);class yt extends a.a.Component{constructor(t){super(t),this.handleClickOK=()=>{this.state.onClickOK&&(this.state.onClickOK(),this.setState({onClickOK:null})),this.setState({open:!1})},this.handleCancel=()=>{this.setState({open:!1})},this.state={open:!1,onClickOK:null},window.showAlert=this.show.bind(this)}show(t){this.setState({open:!0,title:t.title,text:t.text,onClickOK:t.onClickOK||null,showCancel:t.showCancel})}render(){return Object(u.jsx)("div",{children:Object(u.jsxs)(_.a,{open:this.state.open,onClose:this.handleCancel,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(u.jsx)(S.a,{id:"alert-dialog-title",children:this.state.title}),Object(u.jsx)(I.a,{children:Object(u.jsx)(N.a,{id:"alert-dialog-description",children:this.state.text})}),Object(u.jsxs)(T.a,{children:[Object(u.jsx)(d.a,{onClick:this.handleClickOK.bind(this),color:"primary",autoFocus:!0,children:"OK"}),this.state.showCancel?Object(u.jsx)(d.a,{onClick:this.handleCancel.bind(this),color:"primary",autoFocus:!0,children:"Cancel"}):null]})]})})}}var wt=yt;class Ct extends a.a.Component{constructor(t){super(t),this.onEditPost=async()=>{const{message:t}=this.state,{post:e,onClose:n}=this.props;this.setState({loading:!0});const s=g.a.getLocalStorage("token");await b.a.patch("".concat(this.props.editPostEndpoint,"/").concat(e.id,"?token=").concat(s),{message:t}),n(!0)},console.log(t.post),this.state={title:t.post.message.split("\n")[0]||"",message:t.post.message,loading:!1}}render(){const{title:t,message:e,loading:n}=this.state,{post:s,onClose:i}=this.props;return Object(u.jsx)(a.a.Fragment,{children:Object(u.jsx)(_.a,{fullWidth:!0,open:!0,onClose:()=>i(!1),"aria-labelledby":"form-dialog-title",children:n?Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(h.a,{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(S.a,{id:"form-dialog-title",children:"S\u1eeda b\xe0i vi\u1ebft"}),Object(u.jsxs)(I.a,{children:[Object(u.jsxs)(N.a,{children:["B\xe0i vi\u1ebft: ",t,Object(u.jsx)("br",{}),"\u0110\u0103ng l\xfac: ",g.a.getTimeStr(s.time)," ng\xe0y ",g.a.getDateStr(s.time)]}),Object(u.jsx)(l.a,{multiline:!0,rowsMax:"20",value:e,onChange:t=>{this.setState({message:t.target.value})},margin:"normal",variant:"outlined",fullWidth:!0})]}),Object(u.jsxs)(T.a,{children:[Object(u.jsx)(d.a,{onClick:()=>i(!1),color:"primary",children:"Quay l\u1ea1i"}),Object(u.jsx)(d.a,{onClick:this.onEditPost,color:"primary",children:"L\u01afU POST"})]})]})})})}}var Dt=Ct;const St={cardStyle:{maxWidth:"800px",marginTop:"20px",marginRight:"auto",marginLeft:"auto"}},_t={height:"300px",maxWidth:"100%"},Tt=()=>Object(u.jsx)("div",{style:_t,children:Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(h.a,{})]})});class It extends a.a.Component{constructor(t){super(),this.processTimeField=t=>"created_time"===this.props.timeFieldName?t.map((t=>({...t,created_time:new Date(t.created_time).getTime()/1e3}))):t,this.deletePost=t=>async()=>{if(window.confirm("B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn x\xf3a?")){this.setState({loading:!0});const e=g.a.getLocalStorage("token");await b.a.delete("".concat(this.props.deletePostEndpoint,"/").concat(t.id,"?token=").concat(e)),this.loadData()}},this.openOnFB=t=>()=>{window.open("https://www.facebook.com/".concat(t.id),"_blank").focus()},this.onEditDialogClose=t=>{t?this.loadData():this.setState({editingPost:null})},this.props=t,this.state={loading:!0,posts:[],editingPost:null},window.changeHeader("B\xe0i \u0111\xe3 l\xean l\u1ecbch - TongHopEvent")}componentDidMount(){this.loadData()}async loadData(){const{newestFirst:t}=this.props;this.setState({loading:!0,editingPost:null});const e=g.a.getLocalStorage("token"),n=await b.a.get("".concat(this.props.loadFeedEndpoint,"?token=").concat(e));if(n.data.error)this.setState({loading:!1,posts:[]});else{const e=t?n.data:n.data.reverse();this.setState({loading:!1,posts:this.processTimeField(e)})}}_renderMainView(){const{timeFieldName:t}=this.props;return this.state.posts.map(((e,n)=>{const s=e.from&&e.from.id!==p.a.SELF_PAGE_ID;return Object(u.jsx)("div",{style:St.cardStyle,children:Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[Object(u.jsx)("p",{children:Object(u.jsxs)("b",{children:[g.a.getTimeStr(1e3*e[t])," ng\xe0y ",g.a.getDateStr(1e3*e[t])]})}),Object(u.jsx)($.a,{alt:"",src:e.full_picture,style:_t,loader:Object(u.jsx)(Tt,{})}),s&&Object(u.jsx)("p",{style:{backgroundColor:"#eee",padding:"10px",fontWeight:"bold"},children:"(B\xe0i vi\u1ebft n\xe0y do \u0111\u1ed9c gi\u1ea3 \u0111\u0103ng l\xean page)"}),Object(u.jsxs)("p",{children:[g.a.nl2br(e.expanded?e.message:e.message.substring(0,250)),Object(u.jsx)("br",{}),Object(u.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),this.setState({posts:this.state.posts.map(((t,e)=>{const s=JSON.parse(JSON.stringify(t));return n===e&&(s.expanded=!s.expanded),s}))})},children:e.expanded?"Thu g\u1ecdn":"... \u0110\u1ecdc th\xeam"}),Object(u.jsx)("br",{})]}),Object(u.jsxs)("p",{children:[Object(u.jsx)(d.a,{color:"primary",variant:"outlined",onClick:this.deletePost(e),children:"X\xf3a"}),"\xa0\xa0",Object(u.jsx)(d.a,{color:"primary",variant:"outlined",onClick:()=>this.setState({editingPost:e}),disabled:s,children:"S\u1eeda"}),"\xa0\xa0",Object(u.jsx)(d.a,{color:"primary",variant:"outlined",onClick:this.openOnFB(e),children:"Xem tr\xean FB"})]})]})})},e.id)}))}_renderDocNotFound(){return Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),"(Kh\xf4ng c\xf3 d\u1eef li\u1ec7u)",Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]})}render(){const{editingPost:t,loading:e,posts:n}=this.state,s=Object(u.jsxs)("div",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)("center",{children:Object(u.jsx)(h.a,{})})]});return Object(u.jsxs)(u.Fragment,{children:[t&&Object(u.jsx)(Dt,{post:t,onClose:this.onEditDialogClose,editPostEndpoint:this.props.editPostEndpoint}),e?s:n.length>0?this._renderMainView():this._renderDocNotFound()]})}}var Nt=It;var Et=()=>Object(u.jsx)(Nt,{loadFeedEndpoint:"".concat(p.a.BACKEND,"/publish/scheduled"),editPostEndpoint:"".concat(p.a.BACKEND,"/publish/post"),deletePostEndpoint:"".concat(p.a.BACKEND,"/publish/post"),timeFieldName:"scheduled_publish_time",newestFirst:!1});var Bt=()=>Object(u.jsx)(Nt,{loadFeedEndpoint:"".concat(p.a.BACKEND,"/fbfeed"),editPostEndpoint:"".concat(p.a.BACKEND,"/fbfeed"),deletePostEndpoint:"".concat(p.a.BACKEND,"/fbfeed"),timeFieldName:"created_time",newestFirst:!0}),At=n(370),Pt=n(371);const Mt={cardStyle:{maxWidth:"800px",marginTop:"20px",marginRight:"auto",marginLeft:"auto"}};class Lt extends a.a.Component{constructor(){super(...arguments),this.state={...g.a.settings},this.saveSettings=()=>{g.a.setSettings({...this.state}),window.toastr.success("\u0110\xe3 l\u01b0u c\xe0i \u0111\u1eb7t")}}render(){const{markReadOnOpenInbox:t}=this.state;return Object(u.jsx)("div",{style:Mt.cardStyle,children:Object(u.jsx)(o.a,{children:Object(u.jsxs)(r.a,{children:[Object(u.jsxs)("p",{children:[Object(u.jsx)("h2",{children:"C\xe0i \u0111\u1eb7t"}),Object(u.jsx)("br",{}),"L\u01b0u \xfd: C\xe1c c\xe0i \u0111\u1eb7t sau s\u1ebd \u0111\u01b0\u1ee3c l\u01b0u tr\xean tr\xecnh duy\u1ec7t n\xe0y. N\u1ebfu b\u1ea1n \u0111\u1ed5i thi\u1ebft b\u1ecb kh\xe1c, b\u1ea1n c\u1ea7n ch\u1ec9nh l\u1ea1i cho thi\u1ebft b\u1ecb \u0111\xf3."]}),Object(u.jsx)(At.a,{control:Object(u.jsx)(Pt.a,{checked:t,onChange:()=>this.setState({markReadOnOpenInbox:!t}),color:"primary"}),label:'\u0110\xe1nh d\u1ea5u "\u0111\xe3 \u0111\u1ecdc" khi b\u1ea5m v\xe0o \u0111\u1ecdc inbox'}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),Object(u.jsx)(d.a,{variant:"outlined",onClick:this.saveSettings,children:"L\u01b0u c\xe0i \u0111\u1eb7t"})]})})})}}var Ht=Lt,Ft=n(134),Rt=n(37),Kt=n(300);class Ut{static getSocket(){return p.a.SOCKETIO?(Ut.socket||(Ut.socket=Object(Kt.a)(p.a.SOCKETIO,{transports:["websocket"],query:"module=".concat(p.a.SOCKETIO_MODULE,"&token=").concat(g.a.getToken())}),Ut.socket.on("connect",(()=>console.log("connected")))),Ut.socket):null}static subscribeInbox(t){const e=Ut.getSocket();e&&e.on("inbox",t)}static unsubscribeInbox(t){const e=Ut.getSocket();e&&e.offAny(t)}}function Wt(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}Ut.socket=null;const Gt=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((a=>{p.a.PROD||console.log(t,e,n,s);const i=Ut.getSocket(),o=Wt(),c=t=>{i.offAny(c),a(t)};i.on(o,c),i.emit("".concat(t.toLowerCase()," ").concat(e.replace(/\/$/,"")),{requestId:o,query:n,body:s})}))};var Vt=Ut;const zt=a.a.createContext();class Jt extends a.a.Component{constructor(){super(...arguments),this.state={unreadMark:{}},this.fetchUnread=async()=>{const t=await Gt("get","/unread"),e={};for(const{id:n}of t)e[n]=!0;this.setState({unreadMark:e})},this.markUnread=t=>{Vt.getSocket().emit("mark_unread",t);const e={...this.state.unreadMark};e[t]=!0,this.setState({unreadMark:e})},this.markRead=t=>{Vt.getSocket().emit("mark_read",t);const e={...this.state.unreadMark};delete e[t],this.setState({unreadMark:e})}}componentDidMount(){p.a.INBOX_UNREAD_ABILITY&&this.fetchUnread()}render(){return Object(u.jsx)(zt.Provider,{value:{unreadMark:this.state.unreadMark,markUnread:this.markUnread,markRead:this.markRead},children:this.props.children})}}function Xt(t){return function(e){return Object(u.jsx)(zt.Consumer,{children:n=>Object(u.jsx)(t,{...e,...n})})}}class Yt extends a.a.Component{constructor(){super(...arguments),this.state={ready:!1,loading:!1,conversations:[],next:null},this.openConversation=(t,e)=>()=>{const n=Object(Rt.e)(e.toLowerCase()).replace(/[^a-z0-9]+/g,"-");window.location.hash="#/msg/".concat(t,"/").concat(n)},this.inboxUpdateHandler=async t=>{const{data:e}=await Gt("get","/conversations",{limit:5});this.setState((t=>({conversations:Object(Rt.c)(t.conversations,e)})))},this.onYReachEnd=()=>{this.state.next&&!this.state.loading&&this.loadMoreConversations()}}componentDidMount(){this.loadMoreConversations(),Vt.subscribeInbox(this.inboxUpdateHandler)}componentWillUnmount(){Vt.unsubscribeInbox(this.inboxUpdateHandler)}async loadMoreConversations(){if(!this.state.loading){var t;this.setState({loading:!0});const e={};this.state.next&&(e.after=this.state.next);let{data:n,paging:s}=await Gt("get","/conversations",e);p.a.PROD&&(n=n.filter((t=>t.id!==p.a.INBOX_IGNORED_CONVERSATION))),n&&this.setState({conversations:[...this.state.conversations,...n],loading:!1,ready:!0,next:(null===s||void 0===s?void 0:s.next)?null===s||void 0===s||null===(t=s.cursors)||void 0===t?void 0:t.after:null})}}render(){const{unreadMark:t}=this.props;return Object(u.jsx)(Ft.g,{loading:!this.state.ready,loadingMore:this.state.ready&&this.state.loading,onYReachEnd:this.onYReachEnd,children:this.state.conversations.map((e=>{const n=e.senders.data[0].name,s=Object(Rt.b)(e);return Object(u.jsx)(Ft.e,{name:"".concat(n," (").concat(e.message_count,")"),info:e.snippet,onClick:this.openConversation(e.id,n),active:this.props.tid===e.id,unreadDot:!!t[s]},e.id)}))})}}var Qt=Xt(Yt),qt=n(385),Zt=n(285),$t=(n(282),n(101)),te=n(284),ee=n(283);const ne=Xt((t=>{let{psid:e,unreadMark:n,markRead:s,markUnread:a}=t;return Object(u.jsx)(Ft.c,{className:"cs-button cs-button--info",style:{marginRight:"20px"},icon:Object(u.jsx)($t.a,{icon:n[e]?ee.faEnvelopeOpenText:te.faEnvelope}),onClick:()=>{n[e]?s(e):a(e)}})}));var se=t=>{let{loading:e,profile:n,openConversationOnFB:s,openMainMenu:a,psid:i}=t;return e?Object(u.jsxs)(Ft.f,{children:[Object(u.jsx)(Ft.f.Back,{onClick:a}),Object(u.jsx)(Ft.f.Content,{userName:"Loading..."})]}):Object(u.jsxs)(Ft.f,{children:[Object(u.jsx)(Ft.f.Back,{onClick:a}),Object(u.jsx)(Ft.b,{src:n.profile_pic,name:n.name,onClick:s}),Object(u.jsx)(Ft.f.Content,{userName:n.name}),Object(u.jsxs)(Ft.f.Actions,{children:[p.a.INBOX_UNREAD_ABILITY&&Object(u.jsx)(ne,{as:"InfoButton",psid:i}),Object(u.jsx)(Ft.h,{onClick:s})]})]})},ae=n(53),ie=n.n(ae),oe=n(54),ce=n.n(oe),re=n(301);const le=()=>{};const de=function(){class t extends s.Component{render(){const{props:{fancyScroll:t,children:e,forwardedRef:n,...s}}=this;return Object(u.jsx)(u.Fragment,{children:Object(u.jsx)("div",{ref:n,...s,children:e})})}}return a.a.forwardRef(((e,n)=>Object(u.jsx)(t,{forwardedRef:n,...e})))}(),he=(t,e)=>{const n="undefined"!==typeof t?t:e,[a,i]=Object(s.useState)(n);return["undefined"!==typeof t?t:a,t=>{i(t)}]};function je(t,e){let{value:n,onSend:a,onChange:i,autoFocus:o,placeholder:c,fancyScroll:r,className:l,activateAfterChange:d,disabled:h,sendDisabled:j,sendOnReturnDisabled:b,attachDisabled:p,sendButton:g,attachButton:x,onAttachClick:m,...O}=t;const f=Object(s.useRef)(),v=Object(s.useRef)(),[k,y]=he(n,""),[w,C]=he(j,!0),D=()=>{"undefined"!==typeof v.current&&v.current.focus()};Object(s.useImperativeHandle)(e,(()=>({focus:D}))),Object(s.useEffect)((()=>{!0===o&&D()}),[o]),Object(s.useEffect)((()=>{"function"===typeof f.current.updateScroll&&f.current.updateScroll()}));const S=()=>{k.length>0&&a()},_="".concat("cs","-message-input"),T="string"===typeof c?c:"";return Object(u.jsxs)("div",{...O,className:ce()(_,{["".concat(_,"--disabled")]:h},l),children:[!0===x&&Object(u.jsx)("div",{className:"".concat(_,"__tools"),children:Object(u.jsx)(Ft.a,{onClick:m,disabled:!0===h||!0===p})}),Object(u.jsx)("div",{className:"".concat(_,"__content-editor-wrapper"),children:Object(u.jsx)(de,{fancyScroll:r,ref:f,className:"".concat(_,"__content-editor-container"),children:Object(u.jsx)(re.a,{ref:v,className:"".concat(_,"__content-editor"),disabled:h,placeholder:T,onKeyPress:t=>{"Enter"===t.key&&!1===t.shiftKey&&!1===b&&(t.preventDefault(),S())},onChange:t=>{y(t.target.value),i(t.target.value)},value:k,maxRows:5,minRows:1})})}),!0===g&&Object(u.jsx)("div",{className:"".concat(_,"__tools"),children:Object(u.jsx)(Ft.l,{onClick:S,disabled:!0===h||!0===w})})]})}const be=Object(s.forwardRef)(je);be.displayName="MessageInput",be.propTypes={value:ie.a.string,placeholder:ie.a.string,disabled:ie.a.bool,sendOnReturnDisabled:ie.a.bool,sendDisabled:ie.a.bool,fancyScroll:ie.a.bool,activateAfterChange:ie.a.bool,autoFocus:ie.a.bool,onChange:ie.a.func,onSend:ie.a.func,className:ie.a.string,sendButton:ie.a.bool,attachButton:ie.a.bool,attachDisabled:ie.a.bool,onAttachClick:ie.a.func},be.defaultProps={value:void 0,placeholder:"",disabled:!1,sendOnReturnDisabled:!1,fancyScroll:!0,activateAfterChange:!1,autoFocus:!1,sendButton:!0,attachButton:!0,attachDisabled:!1,onAttachClick:le,onChange:le,onSend:le},je.defaultProps=be.defaultProps;var pe=be;qt.a.addLocale(Zt);const ge=new qt.a("en-US");class ue extends a.a.Component{constructor(){super(...arguments),this.state={loading:!0,loadingMore:!1,psid:null,profile:{},threadInfo:{},messages:[],messageAfter:null,messagePending:null,messagePendingId:null,input:""},this.originalTitle=document.title,this.inboxUpdateHandler=async t=>{var e;const{psid:n,messagePendingId:s}=this.state,a=this.props.tid;if(Object(Rt.b)(t)===n){const{data:t}=await Gt("get","/thread/messages",{tid:a,limit:5});this.setState((e=>({messages:Object(Rt.d)(e.messages,t)})))}(null===(e=t.message)||void 0===e?void 0:e.mid)===s&&this.setState({messagePending:null,messagePendingId:null})},this.onYReachStart=async()=>{const{messageAfter:t,loadingMore:e}=this.state;if(t&&!e){this.setState({loadingMore:!0});const e=await Gt("get","/thread/messages",{tid:this.props.tid,after:t});this.setState((t=>{var n,s,a;return{messages:e.data.reverse().concat(t.messages),messageAfter:(null===(n=e.paging)||void 0===n?void 0:n.next)?null===(s=e.paging)||void 0===s||null===(a=s.cursors)||void 0===a?void 0:a.after:null,loadingMore:!1}}))}},this.openConversationOnFB=()=>{window.open("https://fb.com".concat(this.state.threadInfo.link),"_blank")},this.openInNewTab=t=>()=>{window.open(t,"_blank")},this.openMainMenu=()=>{const{goBackTo:t}=this.props;window.location.hash=t||"#/msg"},this.handleSendMessage=async()=>{const{psid:t,input:e}=this.state,{markRead:n}=this.props,s=e.trim();this.setState({messagePending:s,input:""});try{const{message_id:e}=await Object(g.b)("post","/inbox/messages",{},{messaging_type:"MESSAGE_TAG",tag:"HUMAN_AGENT",recipient:{id:t},message:{text:s}});n(t),this.setState({messagePendingId:e})}catch(a){this.setState({messagePending:null,input:s}),window.alert(JSON.stringify(a.response.data))}}}componentDidMount(){this.fetchConversation(this.props.tid),Vt.subscribeInbox(this.inboxUpdateHandler),window.setMessageInput=t=>this.setState({input:t})}componentDidUpdate(t,e){t.tid!==this.props.tid&&this.fetchConversation(this.props.tid),this.state.psid&&this.state.psid!==e.psid&&p.a.INBOX_MARK_READ_ON_OPEN&&this.props.markRead(this.state.psid)}componentWillUnmount(){document.title=this.originalTitle,Vt.unsubscribeInbox(this.inboxUpdateHandler)}async fetchConversation(t){var e,n,s;document.title=p.a.INBOX_TITLE,this.setState({loading:!0});const[a,i]=await Promise.all([Gt("get","/thread/info",{tid:t}),Gt("get","/thread/messages",{tid:t})]);i.data=i.data.reverse();const o=a.senders.data[0].id,c=await Gt("get","/profile",{psid:o});this.setState({threadInfo:a,psid:o,profile:c,messages:i.data,messageAfter:(null===(e=i.paging)||void 0===e?void 0:e.next)?null===(n=i.paging)||void 0===n||null===(s=n.cursors)||void 0===s?void 0:s.after:null,loading:!1}),document.title="".concat(c.name," - ").concat(p.a.INBOX_TITLE)}_renderMessages(){const{loading:t,messages:e,messagePending:n,loadingMore:s}=this.state;if(t)return Object(u.jsx)(Ft.k,{loading:!0});let a="";const i=t=>{const e=Object(Rt.a)(t);return a!==e?(a=e,Object(u.jsx)(Ft.j.Footer,{sender:ge.format(new Date(t.created_time))})):null},o=(t,e)=>e.map(((e,n)=>Object(u.jsxs)(Ft.j,{type:"image",model:{direction:Object(Rt.a)(t),type:"custom"},children:[i(t),Object(u.jsx)(Ft.j.CustomContent,{children:Object(u.jsx)("img",{src:e.preview_url,alt:"",onClick:this.openInNewTab(e.url),style:{width:"200px"}})})]},t.id+n)));return Object(u.jsxs)(Ft.k,{loadingMore:s,onYReachStart:this.onYReachStart,children:[e.map((t=>{const e=(t=>{var e;return((null===(e=t.attachments)||void 0===e?void 0:e.data)||[]).filter((t=>!!t.image_data)).map((t=>t.image_data))})(t);return e.length>0?Object(u.jsx)(u.Fragment,{children:o(t,e)}):(t=>Object(u.jsx)(Ft.j,{model:{message:t.message,sentTime:ge.format(new Date(t.created_time)),sender:t.from.name,direction:Object(Rt.a)(t),position:"single"},children:i(t)},t.id))(t)})),n&&Object(u.jsx)(Ft.j,{model:{message:n,sender:p.a.INBOX_TITLE,direction:"outgoing",position:"single"},className:"pending"}),!p.a.INBOX_SEND_ABILITY&&Object(u.jsx)(Ft.j,{style:{marginBottom:"2em",opacity:"0"}})]})}_renderInput(){const{input:t,messagePending:e}=this.state;return Object(u.jsx)(pe,{as:"MessageInput",value:t,onChange:t=>this.setState({input:t}),onSend:this.handleSendMessage,disabled:!!e,sendDisabled:!!e&&t.length>0,sendOnReturnDisabled:!0,onAttachClick:window.openTemplateDialog,placeholder:"Type here..."})}render(){const{loading:t,profile:e,psid:n}=this.state;return Object(u.jsxs)(Ft.d,{children:[Object(u.jsx)(se,{as:"ConversationHeader",loading:t,profile:e,psid:n,openConversationOnFB:this.openConversationOnFB,openMainMenu:this.openMainMenu}),this._renderMessages(),p.a.INBOX_SEND_ABILITY&&this._renderInput()]})}}var xe=Xt(ue);n(286);class me extends a.a.Component{constructor(){super(...arguments),this.state={tid:null,viewHeight:"100vh"},this.updateHeight=()=>{window.NUI_VIEW_HEIGHT&&this.state.viewHeight!==window.NUI_VIEW_HEIGHT&&this.setState({viewHeight:window.NUI_VIEW_HEIGHT})},this.MessageView=()=>{const{tid:t,viewHeight:e}=this.state,{goBackTo:n}=this.props;return Object(u.jsxs)("div",{style:{position:"relative",height:e},className:t?"chat":"home",children:[Object(u.jsxs)(Ft.i,{children:[Object(u.jsx)(Ft.m,{position:"left",scrollable:!0,children:Object(u.jsx)(Qt,{tid:t})}),t?Object(u.jsx)(xe,{tid:t,goBackTo:n}):Object(u.jsx)(Ft.d,{})]}),Object(u.jsx)(p.a.CustomMessengerWidget,{})]})},this.MessageTidChanged=t=>{let{match:e}=t;return e.params.tid!==this.state.tid&&this.setState({tid:e.params.tid}),null},this.MessageTidReset=()=>(null!==this.state.tid&&this.setState({tid:null}),null)}componentDidMount(){this.intervalId=setInterval(this.updateHeight,1e3)}componentWillUnmount(){clearInterval(this.intervalId)}render(){return Object(u.jsx)(ft.a,{children:Object(u.jsxs)(Jt,{children:[Object(u.jsx)(Ot.a,{path:"/msg",component:this.MessageView}),Object(u.jsx)(Ot.a,{exact:!0,path:"/msg",component:this.MessageTidReset}),Object(u.jsx)(Ot.a,{exact:!0,path:"/msg/:tid/:name",component:this.MessageTidChanged})]})})}}var Oe=Object(Ot.f)(me),fe=n(157),ve=n(366);const ke=240,ye=Object(ve.a)((t=>({root:{display:"flex"},appBar:{zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},appBarShift:{marginLeft:ke,width:"calc(100% - ".concat(ke,"px) !important"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})},menuButton:{marginRight:36},hide:{display:"none"},drawer:{width:ke,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:ke,transition:t.transitions.create("width",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})},drawerClose:{transition:t.transitions.create("width",{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen}),overflowX:"hidden",width:0,[t.breakpoints.up("sm")]:{width:t.spacing(9)+1}},toolbar:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1),...t.mixins.toolbar},content:{flexGrow:1}})));var we=n(395),Ce=n(381),De=n(368),Se=n(380),_e=n(369),Te=n(290),Ie=n.n(Te),Ne=n(292),Ee=n.n(Ne),Be=n(291),Ae=n.n(Be),Pe=n(382),Me=n(372),Le=n.n(Me),He=n(373),Fe=n.n(He),Re=n(374),Ke=n.n(Re),Ue=n(375),We=n.n(Ue),Ge=n(376),Ve=n.n(Ge),ze=n(377),Je=n.n(ze),Xe=n(378),Ye=n.n(Xe),Qe=n(379),qe=n.n(Qe);const Ze=[{list:[{title:"Inbox",href:"#/msg",icon:Object(u.jsx)(Le.a,{})},{title:"Qu\u1ea3n l\xfd",href:"#/manage",icon:Object(u.jsx)(Fe.a,{})},{title:"B\xe0i \u0111\xe3 l\xean l\u1ecbch",href:"#/scheduled",icon:Object(u.jsx)(Ke.a,{})},{title:"B\xe0i \u0111\xe3 \u0111\u0103ng",href:"#/fbfeed",icon:Object(u.jsx)(We.a,{})}]},{separator:!0},{list:[{title:"H\u01b0\u1edbng d\u1eabn",href:"https://blog.ngxson.com/tonghopevent/",icon:Object(u.jsx)(Ve.a,{})},{title:"\u0110i\u1ec1u kho\u1ea3n s\u1eed d\u1ee5ng",href:"https://sites.google.com/view/tonghopevent/",icon:Object(u.jsx)(Je.a,{})}]},{separator:!0},{list:[{title:"T\xf9y ch\u1ec9nh",href:"#/settings",icon:Object(u.jsx)(Ye.a,{})},{title:"\u0110\u0103ng xu\u1ea5t",href:"#/logout",icon:Object(u.jsx)(qe.a,{})}]},{list:[{title:"T\u1ed5ng h\u1ee3p c\xe1c d\u1ef1 \xe1n v\xe0 cu\u1ed9c thi",href:"#/",icon:null},{title:"\u0110\u0103ng b\xe0i (L\u1ea5y \u1ea3nh)",href:"#/getimage",icon:null},{title:"\u0110\u0103ng b\xe0i",href:"#/publish",icon:null},{title:"Xem b\xe0i vi\u1ebft",href:"#/view",icon:null}],hidden:!0}];var $e=Object(Ot.f)((function(t){let{children:e,location:{pathname:n}}=t;const s=ye(),i=Object(fe.a)(),[o,r]=a.a.useState(!1),l=(t=>{for(const{list:e}of Ze)if(e)for(const n of e)if(t.startsWith(n.href))return n;return null})("#"+n),d=n.match(/\/(view\/|login)/),h=t=>()=>{const{href:e}=t;e.startsWith("http")?window.open(e,"_blank").focus():window.location.href=e};return Object(u.jsxs)("div",{className:s.root,children:[Object(u.jsx)(Se.a,{}),Object(u.jsx)(Ce.a,{position:"fixed",style:{zIndex:o?80:100},className:"".concat(s.appBar," ").concat(o?s.appBarShift:""),children:Object(u.jsxs)(De.a,{children:[!d&&Object(u.jsx)(_e.a,{color:"inherit","aria-label":"open drawer",onClick:()=>{r(!0)},edge:"start",className:"".concat(s.menuButton," ").concat(o?s.hide:""),children:Object(u.jsx)(Ie.a,{})}),Object(u.jsx)(c.a,{variant:"h6",noWrap:!0,children:l.title})]})}),Object(u.jsxs)(we.a,{style:{zIndex:90},variant:d?"temporary":"permanent",className:"".concat(s.drawer," ").concat(o?s.drawerOpen:s.drawerClose),classes:{paper:o?s.drawerOpen:s.drawerClose},children:[Object(u.jsx)("div",{className:s.toolbar,children:Object(u.jsx)(_e.a,{onClick:()=>{r(!1)},children:"rtl"===i.direction?Object(u.jsx)(Ae.a,{}):Object(u.jsx)(Ee.a,{})})}),Object(u.jsx)(k.a,{}),Ze.map(((t,e)=>t.list&&!t.hidden?Object(u.jsx)(M.a,{children:t.list.map(((t,e)=>Object(u.jsxs)(L.a,{button:!0,selected:l.href===t.href,onClick:h(t),children:[Object(u.jsx)(Pe.a,{children:t.icon}),Object(u.jsx)(H.a,{primary:t.title})]},e)))},e):t.separator?Object(u.jsx)(k.a,{},e):null))]}),Object(u.jsxs)("main",{className:s.content,children:[Object(u.jsx)("div",{className:s.toolbar}),e]})]})}));var tn=()=>{const t=Object(s.useRef)(null);return Object(s.useEffect)((()=>{t&&t.current&&setInterval((()=>{var e;(e=t.current)&&(window.NUI_VIEW_HEIGHT=e.clientHeight-64,window.NUI_VIEW_WIDTH=e.clientWidth)}),1e3)}),[t]),Object(u.jsx)("div",{ref:t,style:{position:"fixed",top:0,left:0,height:"100%",width:"100%",pointerEvents:"none",zIndex:1e3}})};class en extends a.a.Component{constructor(){super(),this.Home=()=>Object(u.jsx)(X,{gotoPublish:this.gotoPublish.bind(this)}),this.View=t=>{let{match:e}=t;return Object(u.jsx)(q,{id:e.params.id})},this.Publish=()=>Object(u.jsx)(bt,{data:this.state.publishData}),this.GetImage=()=>Object(u.jsx)(mt,{data:this.state.publishData,gotoPublish:this.gotoPublish.bind(this)}),this.Copyright=()=>Object(u.jsxs)("center",{children:[Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),"Developed by\xa0",Object(u.jsx)("b",{children:Object(u.jsx)("a",{href:"https://ngxson.com",target:"_blank",rel:"noopener noreferrer",children:"Nui"})}),Object(u.jsx)("br",{}),"Version ",p.a.VERSION,Object(u.jsx)("br",{}),Object(u.jsx)("br",{})]}),this.Logout=()=>(g.a.removeLocalStorage("token"),window.location.href="#/",window.location.reload(),null),this.state={header:"Home",publishData:g.a.getLocalStorage("publishData")||null}}changeHeader(t){this.state.header!==t&&this.setState({header:t})}gotoPublish(t,e){this.setState({publishData:t}),g.a.setLocalStorage("publishData",t),window.location.hash="#/"+e}render(){return window.changeHeader=this.changeHeader.bind(this),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(Ot.a,{path:"/manage",component:this.Home}),Object(u.jsx)(Ot.a,{path:"/login",component:m}),Object(u.jsx)(Ot.a,{path:"/view/:id",component:this.View}),Object(u.jsx)(Ot.a,{path:"/publish",component:this.Publish}),Object(u.jsx)(Ot.a,{path:"/getimage",component:this.GetImage}),Object(u.jsx)(Ot.a,{path:"/scheduled",component:Et}),Object(u.jsx)(Ot.a,{path:"/fbfeed",component:Bt}),Object(u.jsx)(Ot.a,{path:"/settings",component:Ht}),Object(u.jsx)(Ot.a,{path:"/logout",component:this.Logout}),Object(u.jsx)(this.Copyright,{})]})}}const nn=()=>(window.location.href=g.a.getLocalStorage("token")?"#/msg":"#/login",null);e.default=function(){return Object(u.jsx)(ft.a,{children:Object(u.jsxs)(kt.a,{theme:i.a,children:[Object(u.jsxs)($e,{children:[Object(u.jsx)("div",{className:"mainView",children:Object(u.jsxs)(Ot.c,{children:[Object(u.jsx)(Ot.a,{exact:!0,path:"/",component:nn}),Object(u.jsx)(Ot.a,{path:"/msg",component:Oe}),Object(u.jsx)(Ot.a,{component:en})]})}),Object(u.jsx)(wt,{})]}),Object(u.jsx)(tn,{})]})})}}}]);
//# sourceMappingURL=6.1b840d62.chunk.js.map